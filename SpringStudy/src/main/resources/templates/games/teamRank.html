<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>KBO íŒ€ ìˆœìœ„</title>
    <link rel="stylesheet" th:href="@{/games/teamRank.css}">
    <link rel="icon" type="image/png" href="/dugout.png" />
</head>
<body>


<div class="container">
    <h1>2025ë…„ KBO íŒ€ ìˆœìœ„</h1>

    <!-- ë‚ ì§œ ì„ íƒ -->
    <form method="get" action="/kbo/teamRank">
        <label for="date-select">ë‚ ì§œ ì„ íƒ:</label>
        <select name="date" id="date-select" onchange="this.form.submit()">
            <option th:each="d : ${dates}"
                    th:value="${d}"
                    th:text="${d}"
                    th:selected="${d} == ${selectedDate}">
            </option>
        </select>
    </form>

    <p><strong>ì„ íƒí•œ ë‚ ì§œ:</strong> <span th:text="${selectedDate}">2025-07-24</span></p>

    <!-- ğŸ”¹ íŒ€ ìˆœìœ„ + ê·¸ë˜í”„ ê°€ë¡œ ì •ë ¬ -->
    <div class="rank-graph-wrapper">
        <!-- ì™¼ìª½: íŒ€ ìˆœìœ„ í…Œì´ë¸” -->
        <div class="rank-table-container">
            <table class="rank-table">
                <thead>
                <tr>
                    <th>ìˆœìœ„</th>
                    <th>íŒ€ëª…</th>
                    <th>ê²½ê¸°</th>
                    <th>ìŠ¹</th>
                    <th>íŒ¨</th>
                    <th>ë¬´</th>
                    <th>ìŠ¹ë¥ </th>
                    <th>ê²Œì„ì°¨</th>
                    <th>ìµœê·¼10ê²½ê¸°</th>
                    <th>ì—°ì†</th>
                    <th>í™ˆ</th>
                    <th>ì›ì •</th>
                </tr>
                </thead>
                <tbody>
                <tr th:each="team : ${teams}">
                    <td th:text="${team.rankNum}">1</td>
                    <td th:text="${team.teamName}">í•œí™”</td>
                    <td th:text="${team.game}">92</td>
                    <td th:text="${team.win}">56</td>
                    <td th:text="${team.lose}">34</td>
                    <td th:text="${team.draw}">2</td>
                    <td th:text="${team.winRate}">0.622</td>
                    <td th:text="${team.gameGap}">0.0</td>
                    <td th:text="${team.recent10}">9ìŠ¹0ë¬´1íŒ¨</td>
                    <td th:text="${team.streak}">1íŒ¨</td>
                    <td th:text="${team.home}">28-2-13</td>
                    <td th:text="${team.away}">28-0-21</td>
                </tr>
                </tbody>
            </table>
        </div>
        <!-- ì˜¤ë¥¸ìª½: ë°” ì°¨íŠ¸ + ë¼ì¸ ì°¨íŠ¸ ì„¸ë¡œ ë°°ì¹˜ -->
        <div class="chart-container">
            <canvas id="winrateChart" width="500" height="300"></canvas>
            <canvas id="rankTrendChart" width="500" height="300" style="margin-top: 30px;"></canvas>
        </div>


    </div>


    <!-- ë©”ì¸ìœ¼ë¡œ -->
    <div class="back-btn">
        <a href="/dugout" class="btn">ğŸ  ë”ê·¸ì•„ì›ƒìœ¼ë¡œ ê°€ê¸°</a>
    </div>
</div>


<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script th:inline="javascript">

    const teamColorMap = {
        'KIA': '#C8102E',
        'ì‚¼ì„±': '#005BAC',
        'LG': '#000000',
        'í•œí™”': '#EF7C00',
        'ë¡¯ë°': '#002F6C',
        'SSG': '#C8102E',
        'KT': '#1D1D1D',
        'NC': '#0C234B',
        'í‚¤ì›€': '#862633',
        'ë‘ì‚°': '#002244'
    };


    const teamNames = /*[[${teamNames}]]*/ [];
    const winRates = /*[[${winRates}]]*/ [];

    const backgroundColors = teamNames.map(name => teamColorMap[name] || '#888');
    const borderColors = backgroundColors;

    const ctx = document.getElementById('winrateChart').getContext('2d');
    const chart = new Chart(ctx, {
        type: 'bar',
        data: {
            labels: teamNames,
            datasets: [{
                label: 'íŒ€ë³„ ìŠ¹ë¥ ',
                data: winRates,
                backgroundColor: backgroundColors,
                borderColor: borderColors,
                borderWidth: 1
            }]
        },
        options: {
            responsive: false,
            scales: {
                y: {
                    beginAtZero: true,
                    max: 1.0
                }
            }
        }
    });

</script>


<script>
    fetch('/kbo/rank-timeline')
        .then(res => res.json())
        .then(data => {
            const dates = Object.keys(data).sort();
            const teams = Object.keys(data[dates[0]]);

            const teamColorMap = {
                'KIA': '#C8102E', 'ì‚¼ì„±': '#005BAC', 'LG': '#000000',
                'í•œí™”': '#EF7C00', 'ë¡¯ë°': '#002F6C', 'SSG': '#C8102E',
                'KT': '#1D1D1D', 'NC': '#0C234B', 'í‚¤ì›€': '#862633', 'ë‘ì‚°': '#002244'
            };

            const datasets = teams.map(team => ({
                label: team,
                data: dates.map(date => data[date][team] ?? null),
                borderColor: teamColorMap[team] || 'gray',
                fill: false,
                tension: 0.3
            }));

            new Chart(document.getElementById("rankTrendChart"), {
                type: 'line',
                data: { labels: dates, datasets },
                options: {
                    responsive: false,
                    scales: {
                        y: {
                            min: 1,
                            max: 10,
                            reverse: true,
                            ticks: {
                                stepSize: 1,
                                precision: 0
                            }
                        }
                    },
                    plugins: {
                        legend: {
                            position: 'bottom'
                        }
                    }
                }
            });
        });
</script>

</body>
</html>
