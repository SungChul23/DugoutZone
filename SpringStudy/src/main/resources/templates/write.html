<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ìƒí’ˆ ì¶”ê°€ | Spring Study</title>
  <link rel="stylesheet" href="/list.css">
  <link rel="stylesheet" href="/write.css">
</head>
<body>

<nav class="navbar">
  <a href="/" class="logo">ğŸ›’ Spring Shop</a>
  <div class="nav-links">
    <a href="/list">ìƒí’ˆ ëª©ë¡</a>
  </div>
</nav>

<div class="form-container">
  <h2>ìƒí’ˆ ì¶”ê°€</h2>
  <form action="/add" method="POST">
    <div class="form-group">
      <label for="title">ìƒí’ˆëª…</label>
      <input type="text" id="title" name="title" required>
    </div>

    <div class="form-group">
      <label for="price">ê°€ê²©</label>
      <input type="number" id="price" name="price" required>
    </div>

    <div class="form-group">
      <label for="image">ìƒí’ˆ ì´ë¯¸ì§€</label>
      <input type="file" id="image" name="image" onchange="uploadImage(this)" required>
    </div>

    <!-- ì—…ë¡œë“œëœ ì´ë¯¸ì§€ URLì„ ë‹´ì„ ìˆ¨ê²¨ì§„ í•„ë“œ -->
    <input type="hidden" id="imageUrl" name="imageUrl">

    <button type="submit" class="submit-btn">ìƒí’ˆ ì¶”ê°€</button>
  </form>

  <script>
    async function uploadImage(input) {
      const file = input.files[0];
      if (!file) return;

      const encodedName = encodeURIComponent(file.name);

      // 1. presigned URL ìš”ì²­
      const res = await fetch('/presigned-url?filename=' + encodedName);
      const url = await res.text();
      console.log("Presigned URL:", url);

      // 2. S3ì— PUTìœ¼ë¡œ íŒŒì¼ ì—…ë¡œë“œ
      await fetch(url, {
        method: 'PUT',
        headers: {
          'Content-Type': file.type,
        },
        body: file
      });

      // 3. ìµœì¢… ì´ë¯¸ì§€ URL êµ¬ì„± (ì½ê¸°ìš© URL)
      const imageUrl = url.split('?')[0];  // ì¿¼ë¦¬ ì œê±°í•´ì„œ S3 ê³µê°œ URLë¡œ

      // 4. ìˆ¨ê²¨ì§„ inputì— ë„£ê¸°
      document.getElementById('imageUrl').value = imageUrl;
      console.log("ìµœì¢… ì´ë¯¸ì§€ URL:", imageUrl);
    }
  </script>


  <footer>
  <a href="/" class="btn">ë©”ì¸ìœ¼ë¡œ ëŒì•„ê°€ê¸°</a>
  <p>â“’ 2025 Spring Study Team</p>
</footer>
</body>
</html>
